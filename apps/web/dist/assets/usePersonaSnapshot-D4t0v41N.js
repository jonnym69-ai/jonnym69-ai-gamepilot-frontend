import{r as b}from"./index-2zxZw9Mw.js";import{u as G,b as h}from"./useCurrentMood-DCnI8z6_.js";import{u as w}from"./useLibraryStore-BvHGHpT8.js";function v(){const{games:t}=w(),l=G();return b.useMemo(()=>{try{const o=x(t);return h({signals:o,moodEntry:l})}catch(o){return console.warn("Persona snapshot calculation failed, using fallback:",o),h({signals:R(),moodEntry:l})}},[t,l])}function x(t){const l=t.reduce((e,s)=>{const i=s.hoursPlayed||0;return i>0&&[...s.genres||[],...s.tags||[]].map(n=>typeof n=="string"?n:n.name||n.description||"").filter(Boolean).forEach(n=>{const d=n.toLowerCase();e[d]=(e[d]||0)+i}),e},{}),o=t.reduce((e,s)=>e+(s.hoursPlayed||0),0),r=t.filter(e=>e.lastPlayed&&new Date(e.lastPlayed).getTime()>Date.now()-720*60*60*1e3).length,f=r>0?Math.max(30,Math.min(180,o*60/Math.max(1,r*2))):60,p=r>0?Math.min(14,Math.max(1,Math.round(r/4))):3,m=t.filter(e=>{const i=(e.tags||[]).map(n=>n.toLowerCase()).some(n=>n.includes("multiplayer")||n.includes("co-op")||n.includes("pvp")||n.includes("online")),u=e.platforms?.some(n=>n.code==="steam");return i||u}).length,y=t.length>0?m/t.length:.3,P=t.filter(e=>e.playStatus==="completed").length,M=t.length>0?P/t.length:.5,S=t.filter(e=>{if(!e.lastPlayed)return!1;const s=new Date(e.lastPlayed).getHours();return s>=22||s<=6}).length,g=t.length>0?S/t.length:.2,c=Object.keys(l);let a="Normal";return c.some(e=>e.includes("souls")||e.includes("hardcore")||e.includes("brutal"))?a="Brutal":c.some(e=>e.includes("hard")||e.includes("difficult"))?a="Hard":c.some(e=>e.includes("casual")||e.includes("puzzle")||e.includes("relaxed"))&&(a="Relaxed"),{playtimeByGenre:l,averageSessionLengthMinutes:f,sessionsPerWeek:p,difficultyPreference:a,multiplayerRatio:y,lateNightRatio:g,completionRate:M}}function R(){return{playtimeByGenre:{},averageSessionLengthMinutes:60,sessionsPerWeek:2,difficultyPreference:"Normal",multiplayerRatio:.4,lateNightRatio:.25,completionRate:.3}}export{v as u};
