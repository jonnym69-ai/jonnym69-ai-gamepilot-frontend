import{c as Ge,d as Ie,p as Te,r as v,a as re,j as e,m as L,A as Ce,_ as Ae,u as Le,b as $e,e as Ee}from"./index-db369dc9.js";import{u as ce,a as _e,G as ze,n as Oe}from"./useLibraryStore-cd6ac89d.js";import{u as be}from"./usePersonaSnapshot-4fed8bfb.js";import"./useCurrentMood-a662386a.js";import{M as ye}from"./masterMoods-2bce0da6.js";import{P as H}from"./platforms-1b2f755f.js";import{u as Be,p as De}from"./useMemoryOptimization-43c8807d.js";const Fe=Ge()(Ie(Te((t,a)=>({games:[],libraryLoading:!1,libraryError:null,integrations:{steam:{connected:!1},discord:{connected:!1},youtube:{connected:!1}},integrationLoading:!1,userPreferences:{theme:"dark",animations:!0,reducedMotion:!1,language:"en",notifications:{achievements:!0,friendActivity:!0,gameRecommendations:!0}},setGames:s=>t({games:s}),addGame:s=>t(i=>({games:[...i.games,s]})),updateGame:(s,i)=>t(r=>({games:r.games.map(n=>n.id===s?{...n,...i}:n)})),removeGame:s=>t(i=>({games:i.games.filter(r=>r.id!==s)})),setIntegrationStatus:(s,i)=>t(r=>({integrations:{...r.integrations,[s]:{...r.integrations[s],...i}}})),setSteamId:s=>t({currentSteamId:s}),updateUserPreferences:s=>t(i=>({userPreferences:{...i.userPreferences,...s}})),getGamesByStatus:s=>{const{games:i}=a();return i.filter(r=>r.playStatus===s)},getTotalPlaytime:()=>{const{games:s}=a();return s.reduce((i,r)=>i+(r.hoursPlayed||0),0)},getRecentlyPlayed:(s=5)=>{const{games:i}=a();return i.filter(r=>r.lastPlayed).sort((r,n)=>{var o,h;return(((o=n.lastPlayed)==null?void 0:o.getTime())||0)-(((h=r.lastPlayed)==null?void 0:h.getTime())||0)}).slice(0,s)}}),{name:"gamepilot-store",partialize:t=>({games:t.games,userPreferences:t.userPreferences,integrations:t.integrations,currentSteamId:t.currentSteamId})}),{name:"GamePilotStore"}));function Ue(t,a){if(!t||typeof t!="number"||t<=0){console.warn("Invalid appId provided for game launch:",t);return}const s=(a==null?void 0:a.toLowerCase())||"steam";try{let i;switch(s){case"steam":i=`steam://run/${t}`;break;case"epic":i=`com.epicgames://launch/app/${t}`;break;case"xbox":i=`xbox://${t}`;break;case"playstation":i=`playstation://${t}`;break;default:i=`steam://run/${t}`;break}const r=document.createElement("div");switch(r.className="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 transition-all duration-300",r.innerHTML=`
      <div class="flex items-center gap-2">
        <span class="text-2xl">ðŸŽ®</span>
        <span class="font-bold">Launching ${s} game...</span>
      </div>
    `,document.body.appendChild(r),setTimeout(()=>{document.body.contains(r)&&document.body.removeChild(r)},3e3),s){case"steam":typeof window<"u"&&window.steam?window.steam.openGame(t.toString()):window.location.href=i;break;case"epic":typeof window<"u"&&window.open?window.open(i,"_blank"):window.location.href=i;break;case"xbox":typeof window<"u"&&window.xbox?console.warn("Xbox launch not implemented"):window.location.href=`xbox://${t}`;break;case"playstation":typeof window<"u"&&window.playstation?console.warn("PlayStation launch not implemented"):window.location.href=`playstation://${t}`;break;default:window.location.href=i;break}}catch(i){console.error(`Failed to launch ${s} game:`,i);const r=`Failed to launch ${s} game. Please ensure ${s} is installed and available.`;typeof window<"u"?alert(r):console.error(r)}}const He=()=>{const t=new Date().getHours();return t>=5&&t<12?"morning":t>=12&&t<17?"afternoon":t>=17&&t<22?"evening":"late-night"},We=t=>{const a=t.moodAffinity||{},i=Object.entries(a).sort(([,m],[,u])=>u-m).slice(0,5).map(([m])=>m.toLowerCase()),r=t.averageSessionLengthMinutes||75;let n="medium";r<45?n="short":r>90&&(n="long");const o=[];t.lateNightRatio>.3&&o.push("late-night"),t.multiplayerRatio>.5&&o.push("afternoon","evening"),o.length===0&&o.push("evening");const h=[];return t.completionRate>.7&&h.push("completionist"),t.multiplayerRatio>.5&&h.push("social"),t.lateNightRatio>.3&&h.push("night_owl"),{dominantMoods:i,preferredSessionLength:n,preferredTimesOfDay:o,recentPlayPatterns:h,moodAffinity:a,averageSessionLengthMinutes:r,lateNightRatio:t.lateNightRatio||0,completionRate:t.completionRate||0,multiplayerRatio:t.multiplayerRatio||0}};function Ve(){const[t,a]=v.useState(null),[s,i]=v.useState(!1);return v.useEffect(()=>{const n=re.getCurrentPersona();a(n);const o=setInterval(()=>{const h=re.getCurrentPersona();JSON.stringify(h)!==JSON.stringify(t)&&a(h)},1e3);return i(!0),()=>{clearInterval(o),i(!1)}},[]),{persona:t,isListening:s,refreshPersona:async()=>{try{const n=re.getCurrentPersona();a(n)}catch(n){console.error("Failed to refresh persona:",n)}},isPersonaInitialized:re.isPersonaInitialized()}}function Ye(t){return!t||t.length===0?Ke:t.map(a=>{var s;return{id:a.id,name:a.title,coverImage:a.coverImage,steamUrl:a.appId?`https://store.steampowered.com/app/${a.appId}`:"",price:"Owned",genres:((s=a.genres)==null?void 0:s.map(i=>i.name))||[],moodTags:a.moods||[],difficulty:"Normal",playstyleTags:a.tags||[],narrativeStyle:"medium",sessionSuitability:"flexible"}})}const Ke=[{id:"bg3",name:"Baldur's Gate 3",coverImage:"https://cdn.akamai.steamstatic.com/steam/apps/1086940/library_600x900.jpg",steamUrl:"https://store.steampowered.com/app/1086940",price:"$59.99",genres:["RPG","Adventure","Strategy"],moodTags:["immersive","strategic","social","creative"],difficulty:"Normal",playstyleTags:["story-driven","strategic","social"],narrativeStyle:"deep",sessionSuitability:"long"},{id:"cyberpunk",name:"Cyberpunk 2077",coverImage:"https://cdn.akamai.steamstatic.com/steam/apps/1091500/library_600x900.jpg",steamUrl:"https://store.steampowered.com/app/1091500",price:"$29.99",genres:["RPG","Action","Open World"],moodTags:["energetic","immersive","competitive","creative"],difficulty:"Normal",playstyleTags:["explorer","competitive","story-driven"],narrativeStyle:"deep",sessionSuitability:"medium"},{id:"stardew",name:"Stardew Valley",coverImage:"https://cdn.akamai.steamstatic.com/steam/apps/413150/library_600x900.jpg",steamUrl:"https://store.steampowered.com/app/413150",price:"$14.99",genres:["Simulation","RPG","Farming"],moodTags:["chill","creative","social","relaxed"],difficulty:"Relaxed",playstyleTags:["casual","creative","social"],narrativeStyle:"light",sessionSuitability:"short"},{id:"hades",name:"Hades",coverImage:"https://cdn.akamai.steamstatic.com/steam/apps/1145360/library_600x900.jpg",steamUrl:"https://store.steampowered.com/app/1145360",price:"$24.99",genres:["Roguelike","Action","Indie"],moodTags:["energetic","competitive","focused","challenging"],difficulty:"Hard",playstyleTags:["competitive","achiever","focused"],narrativeStyle:"moderate",sessionSuitability:"short"},{id:"disco",name:"Disco Elysium",coverImage:"https://cdn.akamai.steamstatic.com/steam/apps/646920/library_600x900.jpg",steamUrl:"https://store.steampowered.com/app/646920",price:"$19.99",genres:["RPG","Indie","Turn-Based"],moodTags:["creative","immersive","thoughtful","relaxed"],difficulty:"Normal",playstyleTags:["story-driven","explorer","creative"],narrativeStyle:"deep",sessionSuitability:"medium"},{id:"vampire",name:"Vampire Survivors",coverImage:"https://cdn.akamai.steamstatic.com/steam/apps/1794680/library_600x900.jpg",steamUrl:"https://store.steampowered.com/app/1794680",price:"$4.99",genres:["Action","Roguelike","Survival"],moodTags:["energetic","competitive","focused","addictive"],difficulty:"Normal",playstyleTags:["competitive","achiever","focused"],narrativeStyle:"minimal",sessionSuitability:"short"},{id:"elden",name:"Elden Ring",coverImage:"https://cdn.akamai.steamstatic.com/steam/apps/1245620/library_600x900.jpg",steamUrl:"https://store.steampowered.com/app/1245620",price:"$59.99",genres:["RPG","Action","Open World"],moodTags:["challenging","immersive","focused","competitive"],difficulty:"Brutal",playstyleTags:["explorer","achiever","competitive"],narrativeStyle:"moderate",sessionSuitability:"long"},{id:"hollow",name:"Hollow Knight",coverImage:"https://cdn.akamai.steamstatic.com/steam/apps/367520/library_600x900.jpg",steamUrl:"https://store.steampowered.com/app/367520",price:"$14.99",genres:["Metroidvania","Action","Indie"],moodTags:["challenging","focused","immersive","exploratory"],difficulty:"Hard",playstyleTags:["explorer","achiever","focused"],narrativeStyle:"light",sessionSuitability:"medium"},{id:"slay",name:"Slay the Spire",coverImage:"https://cdn.akamai.steamstatic.com/steam/apps/646570/library_600x900.jpg",steamUrl:"https://store.steampowered.com/app/646570",price:"$16.99",genres:["Roguelike","Strategy","Card Game"],moodTags:["strategic","thoughtful","competitive","challenging"],difficulty:"Hard",playstyleTags:["strategic","competitive","focused"],narrativeStyle:"minimal",sessionSuitability:"short"},{id:"minecraft",name:"Minecraft",coverImage:"https://cdn.akamai.steamstatic.com/steam/apps/239140/library_600x900.jpg",steamUrl:"https://www.minecraft.net",price:"$29.99",genres:["Sandbox","Survival","Creative"],moodTags:["creative","relaxed","social","exploratory"],difficulty:"Relaxed",playstyleTags:["creative","explorer","social","casual"],narrativeStyle:"minimal",sessionSuitability:"flexible"}];function Xe(t){return{playtimeByGenre:{},averageSessionLengthMinutes:60,sessionsPerWeek:3,difficultyPreference:"Normal",multiplayerRatio:.4,lateNightRatio:.2,completionRate:.5}}function qe(t,a=[],s,i=0){const r=Ye(a);if(!t)return{game:r[Math.floor(Math.random()*Math.min(3,r.length))],explanation:"Based on general trends and popularity",score:50};const n=s||Xe(),o=r.map(w=>{let g=0;const f=[],b=Je(w.genres,n.playtimeByGenre);g+=b.points,b.points>0&&f.push(b.reason);const y=Qe(w.moodTags,n);g+=y.points,y.points>0&&f.push(y.reason);const k=Ze(w.playstyleTags,t.traits.archetypeId);g+=k.points,k.points>0&&f.push(k.reason);const d=et(w.difficulty,n.difficultyPreference);g+=d.points,d.points>0&&f.push(d.reason);const S=tt(w.sessionSuitability,n.averageSessionLengthMinutes);return g+=S.points,S.points>0&&f.push(S.reason),{...w,score:g,reasons:f}});o.sort((w,g)=>g.score-w.score);const h=Math.min(i,o.length-1),m=o[h];if(!m||m.score===0){const w=i%r.length;return{game:r[w],explanation:"Based on general trends and popularity",score:50}}const u=m.reasons.length>0?m.reasons.slice(0,3).join(" â€¢ "):"This game matches your gaming preferences";return{game:{id:m.id,name:m.name,coverImage:m.coverImage,steamUrl:m.steamUrl,price:m.price,genres:m.genres,moodTags:m.moodTags,difficulty:m.difficulty,playstyleTags:m.playstyleTags,narrativeStyle:m.narrativeStyle,sessionSuitability:m.sessionSuitability},explanation:u,score:m.score}}function Je(t,a){let s=0,i="";return t.forEach(r=>{if(!r)return;const n=r.toLowerCase();if(a[n]){const o=a[n];o>50?(s+=30,i=r):o>20?(s+=20,i=r):o>5&&(s+=10,i=r)}}),{points:s,reason:s>0?`You love ${i} games`:""}}function Qe(t,a){let s=0,i="";return t.includes("energetic")&&a.sessionsPerWeek>5&&(s+=15,i="Matches your energetic gaming style"),t.includes("relaxed")&&a.sessionsPerWeek<=3&&(s+=15,i="Perfect for your relaxed gaming pace"),t.includes("focused")&&a.averageSessionLengthMinutes>90&&(s+=10,i="Great for your focused gaming sessions"),t.includes("social")&&a.multiplayerRatio>.5&&(s+=10,i="Matches your social gaming preferences"),{points:s,reason:i}}function Ze(t,a){let s=0,i="";return a==="Specialist"&&t.includes("achiever")&&(s+=20,i="Perfect for your achievement-oriented playstyle"),a==="Socialite"&&t.includes("social")&&(s+=20,i="Great for your social gaming preferences"),a==="Casual"&&t.includes("casual")&&(s+=15,i="Matches your casual gaming style"),{points:s,reason:i}}function et(t,a){const s=["Relaxed","Normal","Hard","Brutal"],i=s.indexOf(t),r=s.indexOf(a),n=Math.abs(i-r);return n===0?{points:15,reason:"Perfect difficulty match for your skill level"}:n===1?{points:8,reason:"Good difficulty match for you"}:{points:0,reason:""}}function tt(t,a){let s=0,i="";return t==="short"&&a<=60?(s=10,i="Perfect for your quick gaming sessions"):t==="medium"&&a>60&&a<=120?(s=10,i="Great for your medium gaming sessions"):t==="long"&&a>120?(s=10,i="Perfect for your long gaming sessions"):t==="flexible"&&(s=5,i="Flexible gaming that fits your schedule"),{points:s,reason:i}}function st(){const t=be(),{games:a}=ce(),[s,i]=v.useState(0);return v.useEffect(()=>{const n=()=>{i(h=>h+1)};return window.addEventListener("persona-refreshed",n),localStorage.getItem("persona_refresh_key")&&(n(),localStorage.removeItem("persona_refresh_key")),()=>{window.removeEventListener("persona-refreshed",n)}},[]),v.useMemo(()=>{try{const n=qe(t,a||[],void 0,s);if(s>0){const o=s%10;if(n&&Math.random()>.3)return{...n,explanation:`${n.explanation} â€¢ Fresh recommendation #${s}`,score:Math.min(n.score+(Math.random()*10-5),100)}}return n}catch(n){return console.error("Failed to generate persona recommendation:",n),null}},[t,s])}async function at(t){var E,O,Z,ee,V,Y,te,K,se,D;const{masterMood:a,timeAvailable:s,preferredGenre:i,games:r}=t;if(!r||!Array.isArray(r))return[];const n=(i||"all").toLowerCase(),o=String(s||"medium").toLowerCase(),m=(await Promise.all(r.map(async l=>{if(!l)return null;let G=[];const C=l.genres||l.tags||[];Array.isArray(C)&&(G=C.map(R=>{if(!R)return"";const Q=typeof R=="string"?R:R.name||R.id||R.description||"";return String(Q).toLowerCase()}).filter(Boolean));let _=[];l.moods&&Array.isArray(l.moods)&&l.moods.length>0?_=l.moods.map(R=>String(R||"").toLowerCase()):_=await _e(l);const F={adrenaline:["intense","competitive","high-energy","action-packed"],"brain-power":["strategic","puzzle","thinking","tactical"],zen:["relaxing","cozy","atmospheric","wholesome"],story:["narrative","story-rich","immersive","adventure"],social:["multiplayer","cooperative","party","team-based"],creative:["building","crafting","sandbox","artistic"],nostalgic:["retro","classic","remastered","throwback"]},X=String(a||"").toLowerCase().trim(),ae=(F[a]||[]).map(R=>String(R).toLowerCase().trim()),q=[X,...ae],z=_.some(R=>{const Q=String(R||"").toLowerCase().trim().replace(/\s+/g,"-").replace(/_+/g,"-");return q.includes(Q)})||X==="scary"&&G.includes("horror");l.title&&l.title.includes("Stronghold")&&console.log("ðŸ” DEBUG Stronghold Moods:",{gameTitle:l.title,rawMoods:l.moods,refinedMoods:_,masterMood:a,allowedSubMoods:q,hasMoodMatch:z});const J=n==="all"||G.some(R=>R===n||n===R);let U=1;if(s==="short"){const R=["puzzle","casual","indie","hidden object","match-3"];U=G.some(ue=>R.includes(ue))?1.2:.8}else if(s==="long"){const R=["rpg","strategy","adventure","simulation","mmorpg"];U=G.some(ue=>R.includes(ue))?1.2:.8}const ne=z?.55:.05,de=J?.12:.04,ve=U*.12,ie=Number(l.hoursPlayed??l.totalPlaytime??0)||0,he=String(l.playStatus||"").toLowerCase(),xe=ie===0||he==="unplayed",we=xe?.12:he==="backlog"?.06:0,je=ie>20?.1:ie>5?.06:ie>0?.03:0,fe=l.lastPlayed,me=fe?new Date(fe):null,ge=me&&!isNaN(me.getTime())?(Date.now()-me.getTime())/(1e3*60*60*24):null,Ne=ge!==null&&o==="short"?ge<=7?.06:ge<=30?.03:0:0,pe=_.map(R=>String(R).toLowerCase()),Se=pe.length>0&&pe.every(R=>["experimental","creative","relaxing","strategic","high-energy"].includes(R)),ke=pe.includes("experimental")&&!z?-.05:0,Re=_.length>4?-.1:0,Me=Se&&!z?-.08:0,Pe=ne+de+ve+we+je+Ne+ke+Re+Me;return{game:l,score:Pe,reasoning:z?`Perfect for your ${a} mood.`:xe?"A new pick that still fits your vibe.":"A solid match for your session.",moodMatch:z?1:0,genreMatch:J?1:0,timeScore:1}}))).filter(l=>l!==null).filter(l=>l.moodMatch>0),u=m.sort((l,G)=>G.score-l.score).slice(0,60),w="gp_recent_picks",g=()=>{try{const l=localStorage.getItem(w);return l?JSON.parse(l):[]}catch{return[]}},f=l=>{try{const G=g(),C=[l,...G.filter(_=>_!==l)].slice(0,5);localStorage.setItem(w,JSON.stringify(C))}catch{}},b=g(),y=`gp_last_perfect_play_${String(a||"any")}_${o}`,k=(()=>{try{return localStorage.getItem(y)||""}catch{return""}})(),d=[...u],S=d.find(l=>{var G,C;return String(((G=l.game)==null?void 0:G.id)||"")!==k&&!b.includes(String(((C=l.game)==null?void 0:C.id)||""))})||d[0],A=new Set,$=new Set,p=new Set,M=l=>{var X,ae,q,z,J,U,ne;const G=String(((X=l.game)==null?void 0:X.title)||"").toLowerCase(),C=String(((z=(q=(ae=l.game)==null?void 0:ae.genres)==null?void 0:q[0])==null?void 0:z.name)||((U=(J=l.game)==null?void 0:J.genres)==null?void 0:U[0])||"").toLowerCase(),F=(Array.isArray((ne=l.game)==null?void 0:ne.moods)?l.game.moods:[]).slice(0,2).map(de=>String(de).toLowerCase()).sort().join("|");return!G||A.has(G)||C&&$.has(C)||F&&p.has(F)?!1:(A.add(G),C&&$.add(C),F&&p.add(F),!0)},N=[];S&&M(S)&&N.push(S);const P=5-Math.max(1,Math.round(5*(o==="short"?.3:o==="long"?.45:.38))),c=d.slice(0,25),j=d.slice(25);for(const l of c){if(N.length>=P)break;String(((E=l.game)==null?void 0:E.id)||"")!==String(((O=S==null?void 0:S.game)==null?void 0:O.id)||"")&&String(((Z=l.game)==null?void 0:Z.id)||"")!==k&&(b.includes(String(((ee=l.game)==null?void 0:ee.id)||""))||M(l)&&N.push(l))}for(const l of j){if(N.length>=5)break;String(((V=l.game)==null?void 0:V.id)||"")!==k&&(b.includes(String(((Y=l.game)==null?void 0:Y.id)||""))||M(l)&&N.push(l))}for(;N.length<5&&d.length>0;){const l=d[N.length]||d[d.length-1];if(l&&String(((te=l.game)==null?void 0:te.id)||"")!==k&&!b.includes(String(((K=l.game)==null?void 0:K.id)||""))&&M(l))N.push(l);else break}const I=N.slice(0,5);try{(D=(se=I[0])==null?void 0:se.game)!=null&&D.id&&(localStorage.setItem(y,String(I[0].game.id)),f(String(I[0].game.id)))}catch{}return console.log("ðŸ” DEBUG Top Recommendations:",{masterMood:a,totalResults:m.length,top3:I.slice(0,3).map(l=>{var G;return{title:l.game.title,score:l.score,moodMatch:l.moodMatch,genreMatch:l.genreMatch,moodCount:((G=l.game.moods)==null?void 0:G.length)||0}})}),I}function nt(t){const a=t.appId||t.launcherId;if(!a){oe("No game ID set (appId or launcherId)");return}if(!t.platforms||t.platforms.length===0){oe("No platforms configured");return}const s=t.platforms[0],i=it(s.code,String(a));i?(oe(`Launching ${t.title} on ${s.name}...`),window.location.href=i):oe(`Unsupported platform: ${s.name}`)}function it(t,a){switch(t){case H.STEAM:return`steam://rungameid/${a}`;case H.EPIC:return`com.epicgames.launcher://apps/${a}?action=launch`;case H.GOG:return`goggalaxy://openGame/${a}`;case H.XBOX:return`xbox://launch/${a}`;case H.PLAYSTATION:return`psn://launch/${a}`;case H.NINTENDO:return`nintendo://launch/${a}`;default:return console.warn(`Unsupported platform for launching: ${t}`),null}}const oe=t=>{console.log(" Game Launcher:",t);const a=document.createElement("div");a.textContent=t,a.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    font-weight: bold;
    font-size: 14px;
    z-index: 9999;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    animation: slideIn 0.3s ease-out;
  `;const s=document.createElement("style");s.textContent=`
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  `,document.head.appendChild(s),document.body.appendChild(a),setTimeout(()=>{a.style.animation="slideIn 0.3s ease-out reverse",setTimeout(()=>{document.body.contains(a)&&document.body.removeChild(a)},300)},3e3)},rt=()=>({showSuccess:t=>console.log("Success:",t),showError:t=>console.log("Error:",t),showInfo:t=>console.log("Info:",t)}),ot=()=>{const{games:t,actions:a}=ce(),{showSuccess:s,showError:i}=rt(),[r,n]=v.useState("adrenaline"),[o,h]=v.useState("medium"),[m,u]=v.useState(!1),[w,g]=v.useState(!1),[f,b]=v.useState(null),[y,k]=v.useState([]),[d,S]=v.useState([]);v.useEffect(()=>{(async()=>{if(!t||t.length===0){S([]);return}const{normalizeGamesArray:M}=await Ae(()=>import("./useLibraryStore-cd6ac89d.js").then(T=>T.d),["assets/useLibraryStore-cd6ac89d.js","assets/index-db369dc9.js","assets/index-2d935eec.css"]),N=M(t||[]);S(N)})()},[t]),v.useEffect(()=>{console.log("ðŸŽ¯ Grid Verification:",{total:d.length,masterMoods:ye.length})},[d]);const A=async()=>{if(!d.length){i("No games available in your library");return}u(!0),g(!1);try{console.log("ðŸ” Starting recommendation analysis...");const p=await at({masterMood:r,timeAvailable:o,preferredGenre:"all",games:d});if(console.log("ðŸ” Recommendation results:",p.length,"games found"),p&&p.length>0){const N=[...p].sort(()=>Math.random()-.5).slice(0,3),T=N[0];k(N),b(T),g(!0),s("Perfect match found!"),console.log("ðŸŽ¯ Selected recommendation:",T.game.title)}else i("No games match your criteria")}catch(p){console.error("Recommendation failed:",p),i("Failed to generate recommendations")}finally{u(!1)}},$=()=>{if(y.length>1){const N=[...y.filter(T=>T!==f)].sort(()=>Math.random()-.5)[0];b(N||y[0])}else A()};return e.jsxs("div",{className:"min-h-screen bg-gaming-dark text-white p-8",children:[e.jsxs(L.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-12",children:[e.jsx(L.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-5xl font-black text-white mb-4 tracking-tighter",children:"ðŸŽ¯ FIND YOUR PERFECT PLAY"}),e.jsxs("p",{className:"text-gray-400 text-lg",children:["Neural analysis of your ",d.length," games."]})]}),e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"space-y-12",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-500 font-bold text-sm uppercase tracking-widest mb-6",children:"1. Pick Your Vibe"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3",children:ye.map(p=>e.jsxs("button",{onClick:()=>n(p.id),className:`p-4 rounded-xl font-black text-sm transition-all flex flex-col items-center justify-center min-h-[80px] ${r===p.id?"bg-gradient-to-br from-gaming-primary to-gaming-secondary text-white shadow-2xl border-2 border-gaming-primary/50 transform scale-105":"bg-gray-900/40 border-gray-800 hover:border-white/20 hover:bg-white/10 hover:text-black"}`,children:[e.jsx("span",{className:"text-2xl mb-1",children:p.emoji}),e.jsx("span",{className:"text-[8px] font-black uppercase tracking-tighter leading-tight",children:p.name})]},p.id))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-gray-500 font-bold text-sm uppercase tracking-widest mb-6",children:"2. How Much Time?"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:[{id:"short",name:"Quick",time:"15-30 min",emoji:"âš¡"},{id:"medium",name:"Session",time:"1-2 hours",emoji:"ðŸŽ®"},{id:"long",name:"Deep Dive",time:"3+ hours",emoji:"ðŸŒ™"}].map(p=>e.jsxs("button",{onClick:()=>h(p.id),className:`p-4 rounded-xl font-black text-sm transition-all flex flex-col items-center justify-center ${o===p.id?"bg-gradient-to-br from-gaming-primary to-gaming-secondary text-white shadow-2xl border-2 border-gaming-primary/50 transform scale-105":"bg-gray-900/40 border-gray-800 hover:border-white/20 hover:bg-white/10 hover:text-black"}`,children:[e.jsx("span",{className:"text-2xl mb-1",children:p.emoji}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-tighter",children:p.name}),e.jsx("span",{className:"text-[8px] text-gray-400 mt-1",children:p.time})]},p.id))})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx("button",{onClick:A,disabled:m||d.length===0,className:"px-12 py-6 bg-gradient-to-r from-gaming-primary to-gaming-accent text-white font-black text-xl rounded-2xl shadow-2xl hover:brightness-110 active:scale-95 transition-all disabled:opacity-30 uppercase tracking-tighter",children:m?"Analyzing Neural Patterns...":"Generate Top Pick"})})]})}),e.jsx(Ce,{mode:"wait",children:w&&f&&e.jsxs(L.div,{initial:{opacity:0,scale:.9,y:30},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},className:"mt-16 bg-gradient-to-br from-gray-900 to-black border-2 border-gaming-primary/50 rounded-[2.5rem] p-10 relative overflow-hidden group",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gaming-primary/10 rounded-full blur-3xl group-hover:scale-150 transition-transform"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-40 h-40 bg-gaming-accent/10 rounded-full blur-3xl group-hover:scale-150 transition-transform"}),e.jsx("div",{className:"relative z-10",children:e.jsxs("div",{className:"flex items-start gap-8",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-32 h-40 bg-gradient-to-br from-gaming-primary/20 to-gaming-accent/20 rounded-xl overflow-hidden border-2 border-gaming-primary/30",children:f.game.coverImage?e.jsx("img",{src:f.game.coverImage,alt:f.game.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-4xl",children:"ðŸŽ®"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-3xl font-black mb-2 bg-gradient-to-r from-gaming-primary to-gaming-accent bg-clip-text text-transparent",children:f.game.title}),e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("span",{className:"px-3 py-1 bg-gaming-primary/20 border border-gaming-primary/50 rounded-full text-xs font-black uppercase",children:r}),e.jsx("span",{className:"px-3 py-1 bg-gaming-accent/20 border border-gaming-accent/50 rounded-full text-xs font-black uppercase",children:o}),e.jsxs("span",{className:"text-gaming-primary font-black",children:["Score: ",Math.round(f.score*100),"%"]})]}),e.jsx("p",{className:"text-gray-300 mb-6",children:f.reasoning}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[f.game.genres&&f.game.genres.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs uppercase",children:"Genres"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:f.game.genres.slice(0,3).map((p,M)=>{let N="Unknown";return typeof p=="string"?N=p:p!=null&&p.name?N=p.name:p!=null&&p.id?N=p.id:typeof p=="object"&&(N=JSON.stringify(p)),e.jsx("span",{className:"text-xs bg-gray-800 px-2 py-1 rounded",children:N},M)})})]}),f.game.moods&&f.game.moods.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 text-xs uppercase",children:"Moods"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:f.game.moods.slice(0,3).map((p,M)=>e.jsx("span",{className:"text-xs bg-gray-800 px-2 py-1 rounded",children:p},M))})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>nt(f.game),className:"px-6 py-3 bg-gaming-primary text-white font-black rounded-xl hover:brightness-110 transition-all",children:"ðŸŽ® Play Now"}),y.length>1&&e.jsx("button",{onClick:$,className:"px-6 py-3 bg-gray-800 text-white font-black rounded-xl hover:bg-gray-700 transition-all",children:"ðŸ”„ Get Different"})]})]})]})})]})})]})},lt=t=>{if(t.length===0)return null;const a=Date.now(),s=t.map(n=>{let o=1;if(n.lastLocalPlayedAt){const u=(a-new Date(n.lastLocalPlayedAt).getTime())/864e5;o+=u*2}const h=n.localSessionCount||0;h===0?o+=10:h<5&&(o+=5);const m=n.hoursPlayed||0;return m>1&&m<20&&n.playStatus!=="completed"&&(o+=3),{game:n,weight:o}}),i=s.reduce((n,o)=>n+o.weight,0);let r=Math.random()*i;for(const{game:n,weight:o}of s)if(r-=o,r<=0)return n;return s[0].game};function ct({src:t,alt:a,className:s="",onLoad:i,onError:r}){const[n,o]=v.useState(!1),[h,m]=v.useState(!1),[u,w]=v.useState(!1),g=v.useRef(null),{observe:f,unobserve:b}=Be(d=>{d.forEach(S=>{S.isIntersecting&&(m(!0),g.current&&b(g.current))})},{threshold:.1,rootMargin:"50px"});v.useEffect(()=>(g.current&&f(g.current),()=>{g.current&&b(g.current)}),[f,b]);const y=()=>{o(!0),i==null||i()},k=()=>{w(!0),r==null||r()};return v.useEffect(()=>{h&&!u&&De(t).then(y).catch(k)},[h,t,u]),e.jsxs("div",{ref:g,className:`relative aspect-square overflow-hidden ${s}`,children:[e.jsxs("div",{className:`
          absolute inset-0 bg-gradient-to-br from-gray-800 via-gray-900 to-black 
          flex items-center justify-center transition-all duration-500
          ${n?"opacity-0 scale-95":"opacity-100 scale-100"}
        `,children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"text-4xl text-gray-600",children:"ðŸŽ®"}),e.jsx("div",{className:"absolute inset-0 blur-lg bg-gaming-primary/10 scale-150"})]}),e.jsx("div",{className:"absolute bottom-2 left-0 right-0 flex justify-center",children:e.jsx("div",{className:"w-8 h-1 bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full w-3/5 bg-gradient-to-r from-gaming-primary to-gaming-secondary rounded-full"})})})]}),h&&!u&&e.jsx("img",{src:t,alt:a,className:`
            absolute inset-0 w-full h-full object-center transition-opacity duration-500
            ${n?"opacity-100":"opacity-0"}
          `,onLoad:()=>o(!0),onError:()=>w(!0),loading:"lazy",decoding:"async",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",style:{imageRendering:"auto",WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",backfaceVisibility:"hidden",transform:"translateZ(0)",willChange:"opacity"}}),u&&e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-br from-red-900/30 via-red-800/20 to-red-900/30 flex flex-col items-center justify-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"text-3xl text-red-500",children:"ðŸš«"}),e.jsx("div",{className:"absolute inset-0 blur-lg bg-red-500/10 scale-150"})]}),e.jsx("span",{className:"text-xs text-red-400 mt-2 font-medium",children:"Failed to load"})]}),n&&!u&&e.jsxs("div",{className:"absolute inset-0 opacity-0 hover:opacity-100 transition-opacity duration-300 pointer-events-none",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-white/5 to-transparent"})]})]})}const dt=({games:t,onLaunchGame:a})=>{const[s,i]=v.useState(null),[r,n]=v.useState(!1),o=()=>{n(!0),i(null),setTimeout(()=>{const u=lt(t);i(u),n(!1)},800)},h=()=>{s&&(s.appId?a(s.appId.toString()):console.warn("No appId found for game:",s.title))},m=()=>{o()};return e.jsxs("section",{className:"mb-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-3xl font-bold text-white flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸŽ²"}),"Surprise Me"]}),e.jsxs("div",{className:"text-sm text-gray-400",children:[t.length," games available"]})]}),s?e.jsx("div",{className:"glass-morphism rounded-xl overflow-hidden",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"w-32 h-32 flex-shrink-0 overflow-hidden rounded-md bg-gradient-to-br from-gaming-primary/20 to-gaming-secondary/20",children:s.coverImage?e.jsx(ct,{src:s.coverImage,alt:s.title,className:"w-full h-full"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("div",{className:"text-3xl text-gray-500",children:"ðŸŽ®"})})}),e.jsxs("div",{className:"flex-1 p-6 flex flex-col justify-center",children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:s.title}),s.genres&&s.genres.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:s.genres.slice(0,3).map(u=>e.jsx("span",{className:"px-2 py-1 bg-gaming-accent/20 rounded text-xs text-gaming-accent",children:u.name},u.id))}),e.jsxs("div",{className:"space-y-2 mb-6 text-gray-300",children:[s.hoursPlayed&&e.jsxs("p",{children:["â±ï¸ ",Math.floor(s.hoursPlayed),"h played"]}),s.localSessionCount&&e.jsxs("p",{children:["ðŸŽ® ",s.localSessionCount," sessions"]}),s.playStatus&&e.jsxs("p",{children:["ðŸ“Š Status: ",s.playStatus]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:h,className:"px-6 py-3 bg-gradient-to-r from-gaming-primary to-gaming-secondary text-white rounded-lg font-semibold hover:opacity-90 transition-all",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"â–¶ï¸"}),"Play Now"]})}),e.jsx("button",{onClick:m,className:"px-6 py-3 bg-gray-700 text-white rounded-lg font-semibold hover:bg-gray-600 transition-all",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ðŸŽ²"}),"Spin Again"]})})]})]})]})}):e.jsxs("div",{className:"glass-morphism rounded-xl p-12 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸŽ¯"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Can't decide what to play?"}),e.jsx("p",{className:"text-gray-300",children:"Let us pick the perfect game from your library based on your play history and preferences."})]}),e.jsx("button",{onClick:o,disabled:r||t.length===0,className:"px-8 py-4 bg-gradient-to-r from-gaming-primary to-gaming-secondary text-white rounded-lg font-semibold text-lg hover:opacity-90 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:r?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"animate-spin",children:"ðŸŽ²"}),"Picking your game..."]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"ðŸŽ²"}),"Surprise Me"]})}),t.length===0&&e.jsx("p",{className:"text-sm text-gray-400 mt-4",children:"Import some games first to get surprised!"})]})]})},mt=[{id:"1091500",title:"Cyberpunk 2077",genres:["rpg","action"],globalRating:85,popularity:95,description:"An open-world, action-adventure story set in Night City."},{id:"1145360",title:"Hades",genres:["action","roguelike"],globalRating:98,popularity:80,description:"Defy the god of the dead as you hack and slash out of the Underworld."},{id:"1245620",title:"Elden Ring",genres:["rpg","action"],globalRating:95,popularity:90,description:"Rise, Tarnished, and be guided by grace to brandish the power of the Elden Ring."},{id:"646570",title:"Slay the Spire",genres:["roguelike","strategy"],globalRating:97,popularity:70,description:"A fusion of card games and roguelikes."},{id:"413150",title:"Stardew Valley",genres:["simulation","rpg"],globalRating:98,popularity:85,description:"You have inherited your grandfather's old farm plot in Stardew Valley."},{id:"219150",title:"Hotline Miami",genres:["action","indie"],globalRating:97,popularity:60,description:"A high-octane action game overflowing with raw brutality."},{id:"268910",title:"Cuphead",genres:["action","platformer"],globalRating:96,popularity:75,description:"A classic run and gun action game heavily focused on boss battles."},{id:"105600",title:"Terraria",genres:["action","adventure","indie"],globalRating:98,popularity:85,description:"Dig, Fight, Explore, Build!"},{id:"367520",title:"Hollow Knight",genres:["action","adventure","indie"],globalRating:97,popularity:70,description:"Forge your own path in Hollow Knight! An epic action adventure."},{id:"292030",title:"The Witcher 3: Wild Hunt",genres:["rpg","adventure"],globalRating:98,popularity:95,description:"Become a monster slayer for hire and embark on an epic journey."},{id:"400",title:"Portal",genres:["puzzle","action"],globalRating:98,popularity:90,description:"A series of first and third person puzzles."},{id:"620",title:"Portal 2",genres:["puzzle","action"],globalRating:98,popularity:90,description:"The sequel to the award-winning Portal."},{id:"250900",title:"The Binding of Isaac: Rebirth",genres:["action","roguelike"],globalRating:97,popularity:75,description:"A randomly generated action RPG shooter with heavy RPG elements."},{id:"311210",title:"Call of Duty: Black Ops III",genres:["fps","multiplayer"],globalRating:80,popularity:85,description:"A dark, gritty future where a new breed of Black Ops soldier emerges."},{id:"271590",title:"Grand Theft Auto V",genres:["action","adventure"],globalRating:95,popularity:98,description:"When a young street hustler, a retired bank robber and a terrifying psychopath find themselves entangled."},{id:"1174180",title:"Red Dead Redemption 2",genres:["action","adventure"],globalRating:97,popularity:95,description:"Arthur Morgan and the Van der Linde gang are outlaws on the run."},{id:"1938090",title:"Call of Duty: Modern Warfare II",genres:["action","fps"],globalRating:82,popularity:90,description:"Task Force 141 makes its diplomatic return."},{id:"550",title:"Left 4 Dead 2",genres:["action","fps","multiplayer"],globalRating:97,popularity:95,description:"Set in the zombie apocalypse."},{id:"230410",title:"Warframe",genres:["action","rpg","multiplayer"],globalRating:91,popularity:80,description:"Ninjas Play Free."},{id:"570",title:"Dota 2",genres:["moba","multiplayer"],globalRating:82,popularity:85,description:"Every day, millions of players worldwide enter battle as one of over a hundred Dota heroes."},{id:"730",title:"Counter-Strike 2",genres:["fps","multiplayer"],globalRating:88,popularity:90,description:"The next installment in the legendary Counter-Strike series."},{id:"578080",title:"PUBG: BATTLEGROUNDS",genres:["action","multiplayer"],globalRating:57,popularity:80,description:"Land, loot, and outlast your opponents."}];function W(t){return t?Array.isArray(t)?t.map(a=>String(a)).filter(Boolean):[String(t)].filter(Boolean):[]}function B(t){return String(t||"").toLowerCase().trim().replace(/\s+/g,"-").replace(/_+/g,"-")}function le(t,a,s){return Math.max(a,Math.min(s,t))}function gt(t){const a={},s={};for(const n of t){const o=Number((n==null?void 0:n.hoursPlayed)??(n==null?void 0:n.totalPlaytime)??0)||0,h=le(1+o/10,1,6),m=W(n==null?void 0:n.moods).map(B),w=(Array.isArray(n==null?void 0:n.genres)?n.genres:[]).map(g=>typeof g=="string"?g:(g==null?void 0:g.id)||(g==null?void 0:g.name)||"").filter(Boolean).map(B);for(const g of m)a[g]=(a[g]||0)+h;for(const g of w)s[g]=(s[g]||0)+h}const i=Object.entries(a).sort(([,n],[,o])=>o-n).slice(0,6).map(([n])=>n),r=Object.entries(s).sort(([,n],[,o])=>o-n).slice(0,6).map(([n])=>n);return{topMoods:i,topGenres:r,moodWeights:a,genreWeights:s}}function pt(t){const{games:a,userMood:s,timeAvailable:i,category:r}=t,n=new Set(a.map(c=>String(c.id||c.appId||"")));let o=mt.filter(c=>!n.has(c.id));if(r)switch(r){case"top_rated":o=o.sort((c,j)=>(j.globalRating||0)-(c.globalRating||0)).slice(0,20);break;case"underrated":o=o.filter(c=>(c.globalRating||0)>=85&&(c.popularity||0)<=40).sort((c,j)=>(j.globalRating||0)-(c.globalRating||0)).slice(0,15);break;case"hidden_gems":o=o.filter(c=>(c.popularity||0)<=30).sort((c,j)=>(j.globalRating||0)-(c.globalRating||0)).slice(0,15);break}const h=o.map(c=>{const j=new Set;return c.genres.forEach(I=>{(ze[I.toLowerCase()]||[]).forEach(O=>j.add(O))}),{...c,moods:Array.from(j)}}),m=gt(a),u=s?B(s):"",w=String(i||"medium").toLowerCase(),g=w==="short"?.35:w==="long"?.5:.42,b=[...h.map(c=>{const j=W(c.moods).map(B),I=W(c.genres).map(B),E=u&&j.includes(u)?1:0,O=j.reduce((D,l)=>D+(m.moodWeights[l]||0),0),Z=I.reduce((D,l)=>D+(m.genreWeights[l]||0),0),ee=le((Number(c.globalRating)||0)/100,0,1),V=(E?.55:0)+le(O/25,0,.25)+le(Z/25,0,.2)+ee*.2,Y=I.includes("indie"),te=(Number(c.globalRating)||0)>0&&(Number(c.globalRating)||0)<90,K=Y&&te?.08:Y?.04:0,se=V+K;return{...c,_score:se,_reasons:{moodMatch:E,baseRelevance:V,discoveryBoost:K}}})].sort((c,j)=>(j._score||0)-(c._score||0)),y=Math.max(2,Math.round(10*g)),k=10-y,d=b.slice(0,25).slice(0,k),A=[...b.slice(25)].sort(()=>Math.random()-.5).slice(0,y),$=[...d,...A],p=new Set,M=$.filter(c=>{const j=String(c.title||"").toLowerCase();return!j||p.has(j)?!1:(p.add(j),!0)}),x=[...(u&&M.some(c=>W(c.moods).map(B).includes(u))?M.filter(c=>W(c.moods).map(B).includes(u)):M).map(c=>{var I;const j=[`Highly rated: ${c.globalRating}% on Steam`];return u&&W(c.moods).map(B).includes(u)&&j.unshift(`Matches your ${u} mood`),(I=c._reasons)!=null&&I.discoveryBoost&&j.push("Discovery pick: boosting smaller/indie gems"),{id:c.id,appId:c.id,title:c.title,name:c.title,description:c.description,globalRating:c.globalRating,genres:c.genres,moods:c.moods,reasons:j.slice(0,2),coverImage:`https://cdn.akamai.steamstatic.com/steam/apps/${c.id}/capsule_616x353.jpg`,headerImage:`https://cdn.akamai.steamstatic.com/steam/apps/${c.id}/header.jpg`}})].sort(()=>Math.random()-.5),P=[...new Set(x.flatMap(c=>c.genres))].map(c=>({id:c.toLowerCase(),name:c}));return{games:x.slice(0,10),totalFound:x.length,genresSearched:P}}function ut({games:t,onRecommendationsChange:a,limit:s=10,category:i}){const[r,n]=v.useState({recommendations:{games:[],totalFound:0,genresSearched:[]},isLoading:!1,error:null,lastRefresh:null}),o=v.useRef(0),h=2e3,m=v.useCallback(async()=>{const f=Date.now();if(f-o.current<h){console.log("ðŸ”„ Refresh throttled - please wait");return}o.current=f,console.log("ðŸ”„ Refreshing Steam recommendations..."),n(b=>({...b,isLoading:!0,error:null}));try{const b=await pt({games:t||[],category:i});n({recommendations:b,isLoading:!1,error:null,lastRefresh:new Date}),a==null||a(b)}catch(b){const y=b instanceof Error?b.message:"Failed to load Steam recommendations";n(k=>({...k,isLoading:!1,error:y}))}},[t,s]);v.useEffect(()=>{t&&t.length>0&&!r.lastRefresh&&!r.isLoading&&m()},[t,m,r.lastRefresh,r.isLoading]);const u=v.useCallback(()=>{const f={games:[],totalFound:0,genresSearched:[]};n({recommendations:f,isLoading:!1,error:null,lastRefresh:null}),a==null||a(f)},[a]),w=r.recommendations.games.length>0,g=r.recommendations.games.length;return{...r,refreshRecommendations:m,clearRecommendations:u,hasRecommendations:w,recommendationCount:g}}const ht=({userMood:t,personaTraits:a,className:s=""})=>{var T;const{games:i}=ce(),[r,n]=v.useState("top_rated"),{recommendations:o,isLoading:h,error:m,lastRefresh:u,refreshRecommendations:w,clearRecommendations:g,hasRecommendations:f,recommendationCount:b}=ut({games:i,limit:25,category:r}),[y,k]=v.useState(null);v.useEffect(()=>{o.games.length>0&&!y&&k(o.games[0])},[o.games,y]);const d=async x=>{n(x),k(null),await w()},S=async()=>{if(await w(),o.games.length>0){const x=Math.floor(Math.random()*o.games.length);k(o.games[x])}},A=x=>{k(x)},$=x=>{const P=`https://store.steampowered.com/app/${x.appId||x.id}`;window.open(P,"_blank")},p=x=>{const P=x.currentTarget,c=P.dataset.appId,j=[`https://cdn.akamai.steamstatic.com/steam/apps/${c}/capsule_616x353.jpg`,`https://cdn.akamai.steamstatic.com/steam/apps/${c}/header.jpg`],I=P.getAttribute("src"),E=j.findIndex(O=>O===I);E<j.length-1?P.src=j[E+1]:(P.style.display="none",P.parentElement&&(P.parentElement.innerHTML='<span class="text-3xl">ðŸŽ®</span>'))},M=x=>({Action:"text-red-400",Adventure:"text-green-400",RPG:"text-purple-400",Strategy:"text-blue-400",Simulation:"text-yellow-400",Sports:"text-orange-400",Racing:"text-pink-400",Puzzle:"text-indigo-400",Platformer:"text-teal-400",FPS:"text-red-500"})[x]||"text-gray-400",N=x=>x>=80?"text-green-400":x>=60?"text-yellow-400":x>=40?"text-orange-400":"text-red-400";return m?e.jsxs("div",{className:`glass-morphism rounded-xl p-8 ${s}`,children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ›’"}),"What Should I Buy Next?"]}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-xl mb-4",children:"âš ï¸"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Unable to load Steam recommendations"}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:m}),e.jsx("button",{onClick:S,className:"px-4 py-2 bg-gaming-primary text-white rounded-lg hover:bg-gaming-primary/80 transition-colors",children:"Try Again"})]})]}):!f&&!h?e.jsxs("div",{className:`glass-morphism rounded-xl p-8 ${s}`,children:[e.jsxs("h2",{className:"text-2xl font-bold text-white mb-6 flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ›’"}),"What Should I Buy Next?"]}),(t||a)&&e.jsx("div",{className:"mb-6 p-4 bg-white/5 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Current Context:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsx("span",{className:"text-gaming-primary font-bold",children:"Free"}),a&&e.jsx("span",{className:"text-gaming-primary text-sm",children:a.archetypeId})]})]})}),e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-xl mb-4",children:"ðŸŽ®"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"No Steam recommendations available"}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Add more games to your library to get personalized recommendations"}),e.jsx("button",{onClick:S,className:"px-4 py-2 bg-gaming-primary text-white rounded-lg hover:bg-gaming-primary/80 transition-colors",children:"Load Recommendations"})]})]}):e.jsxs("div",{className:`glass-morphism rounded-xl p-8 ${s}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:"ðŸ›’"}),"What Should I Buy Next?"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[u&&e.jsxs("span",{className:"text-white/40 text-xs",children:[b," games â€¢ ",new Date(u).toLocaleTimeString()]}),e.jsxs("button",{onClick:S,disabled:h,className:"px-3 py-1 bg-gaming-primary/20 text-gaming-primary rounded-lg hover:bg-gaming-primary/30 transition-colors disabled:opacity-50 text-sm",children:["ðŸ”„"," Refresh"]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex bg-white/5 rounded-lg p-1",children:[{id:"top_rated",label:"â­ Top Rated",desc:"Highest rated games on Steam"},{id:"underrated",label:"ðŸ’Ž Underrated",desc:"High quality, low popularity"},{id:"hidden_gems",label:"ðŸ’ Hidden Gems",desc:"Under-the-radar discoveries"}].map(x=>e.jsx("button",{onClick:()=>d(x.id),disabled:h,className:`flex-1 px-4 py-3 rounded-lg font-medium transition-all text-sm ${r===x.id?"bg-gaming-primary text-white shadow-lg":"text-white/70 hover:text-white hover:bg-white/10"} disabled:opacity-50`,title:x.desc,children:x.label},x.id))})}),(t||a)&&e.jsxs("div",{className:"mb-6 p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-white/60 text-sm",children:"Recommendations based on:"}),e.jsx("div",{className:"flex items-center gap-2",children:o.genresSearched.map(x=>e.jsx("span",{className:`text-sm ${M(x.name)}`,children:x.name},x.id))})]}),e.jsxs("p",{className:"text-white/60 text-xs",children:["Found ",o.totalFound," games"]})]}),h?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-gray-400 text-xl mb-4 animate-spin",children:"ðŸ”„"}),e.jsx("p",{className:"text-gray-300",children:"Finding Steam recommendations..."})]}):y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white/5 rounded-lg p-6 mb-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-32 h-32 bg-gaming-primary/20 rounded-lg flex items-center justify-center flex-shrink-0 overflow-hidden",children:y.coverImage?e.jsx("img",{src:y.coverImage,alt:y.title,className:"w-full h-full object-cover","data-app-id":y.id,onError:p}):e.jsx("span",{className:"text-3xl",children:"ðŸŽ®"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:y.title}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`font-bold ${N(y.globalRating||0)}`,children:y.globalRating?`${y.globalRating}% Match`:"N/A"}),e.jsx("span",{className:"text-white/40",children:"â€¢"}),e.jsx("span",{className:"text-white/60 text-sm",children:((T=y.genres)==null?void 0:T.slice(0,2).join(", "))||"Various"})]}),y.description&&e.jsx("p",{className:"text-white/70 text-sm leading-relaxed mb-3 line-clamp-3",children:y.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-white/60 mb-3",children:[e.jsx("span",{children:"Steam"}),y.releaseDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:new Date(y.releaseDate).getFullYear()})]})]})]})]})}),o.games.length>1&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-white/60 text-sm mb-3",children:"Other suggestions:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:o.games.filter(x=>x.id!==y.id).slice(0,4).map(x=>{var P;return e.jsxs("button",{onClick:()=>A(x),className:"bg-white/5 rounded-lg p-3 hover:bg-white/10 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:`text-sm font-medium ${N(x.globalRating||0)}`,children:["Score: ",x.globalRating||"N/A"]}),e.jsx("span",{className:"text-white/60 text-xs truncate",children:((P=x.genres[0])==null?void 0:P.name)||"Various"})]}),e.jsx("div",{className:"text-white text-sm font-medium truncate",children:x.title})]},x.id)})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>$(y),className:"flex-1 px-4 py-3 bg-gaming-accent hover:bg-gaming-primary text-white rounded-lg font-semibold transition-all transform hover:scale-105 flex items-center justify-center gap-2",children:[e.jsx("span",{children:"ðŸ›’"}),"Buy on Steam"]}),e.jsxs("button",{onClick:S,disabled:h,className:"px-4 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-semibold transition-colors disabled:opacity-50",children:["ðŸ”„"," New Suggestion"]})]})]}):null]})},xt=()=>{var k;Le();const{user:t,persona:a}=$e(),{games:s,actions:i}=ce();Fe();const{showSuccess:r,showError:n}=Ee(),o=Ve(),h=be();st();const m=o.persona||a||h,u=v.useMemo(()=>Oe(s||[]),[s]),w=v.useMemo(()=>{if(!m||!m.signals)return null;try{return We(m.signals)}catch(d){return console.warn("Failed to generate persona context:",d),null}},[m]),g=async d=>{if(!(d!=null&&d.id)||!(d!=null&&d.title)){n("Invalid game data");return}try{r(`Launching ${d.title}...`),d.appId?(await Ue(d.appId),r(`${d.title} launched successfully!`)):n(`No launch ID available for ${d.title}`)}catch{n(`Failed to launch ${d.title}`)}},f=v.useMemo(()=>{var N,T;if(!u.length)return null;const d=((N=w==null?void 0:w.dominantMoods)==null?void 0:N[0])||"Casual",S={};u.forEach(x=>{var P;(P=x.genres)==null||P.forEach(c=>{const j=typeof c=="string"?c:c.name;j&&(S[j]=(S[j]||0)+1)})});const A=((T=Object.entries(S).sort(([,x],[,P])=>P-x)[0])==null?void 0:T[0])||"action",$=Math.floor(u.length*2.5),p=He(),M=`Your gaming style: ${d} during ${p}`;return{dominantMood:d,topGenre:A,totalHours:$,microInsight:M}},[u,w]),b=v.useMemo(()=>u.find(d=>d.lastPlayed)||u[0],[u]),y=v.useMemo(()=>[{id:"streak",title:"5-Day Streak",icon:"ðŸ”¥",color:"bg-orange-500"},{id:"mood",title:"Mood Explorer",icon:"ðŸŽ­",color:"bg-purple-500"},{id:"genre",title:"Genre Master",icon:"ðŸŽ®",color:"bg-blue-500"}],[]);return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gaming-dark via-gray-900 to-gaming-darker relative overflow-hidden",children:[e.jsx("div",{className:"fixed inset-0 overflow-hidden pointer-events-none"}),e.jsxs("div",{className:"relative z-10 px-8 py-8",children:[e.jsxs(L.section,{className:"text-center mb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-bold text-white mb-4",children:["Welcome back, ",(t==null?void 0:t.displayName)||(t==null?void 0:t.username)||"Gamer"," ðŸŽ®"]}),e.jsx("p",{className:"text-xl text-gray-300",children:"Ready to crush some games?"})]}),f&&e.jsx(L.section,{className:"mb-12",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"gaming-card rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸŽ®"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Gaming Style"}),e.jsx("div",{className:"text-lg font-semibold text-white capitalize",children:f.dominantMood})]}),e.jsxs("div",{className:"gaming-card rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸŽ¯"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Top Genre"}),e.jsx("div",{className:"text-lg font-semibold text-white capitalize",children:f.topGenre})]}),e.jsxs("div",{className:"gaming-card rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ”¥"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Current Streak"}),e.jsx("div",{className:"text-lg font-semibold text-white",children:"5 days"})]}),e.jsxs("div",{className:"gaming-card rounded-xl p-4 text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"â±ï¸"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total Hours"}),e.jsxs("div",{className:"text-lg font-semibold text-white",children:[f.totalHours,"h"]})]}),e.jsxs("div",{className:"gaming-card rounded-xl p-4 text-center md:col-span-1 col-span-2",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ’¡"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Micro-Insight"}),e.jsx("div",{className:"text-sm font-semibold text-white",children:f.microInsight})]})]})}),e.jsx(L.section,{className:"mb-12",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsx(ot,{})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12",children:[e.jsx(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"gaming-card rounded-xl p-6 border border-green-500/30",children:[e.jsxs("h3",{className:"text-lg font-gaming font-semibold text-white mb-6 uppercase tracking-wider flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),"Surprise Me"]}),e.jsx(dt,{games:u,onLaunchGame:g})]})}),e.jsx(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"gaming-card rounded-xl p-6 border border-blue-500/30",children:[e.jsxs("h3",{className:"text-lg font-gaming font-semibold text-white mb-6 uppercase tracking-wider flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),"What Should I Buy Next?"]}),e.jsx(ht,{})]})}),b&&e.jsx(L.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"gaming-card rounded-xl p-6 border border-purple-500/30",children:[e.jsxs("h3",{className:"text-lg font-gaming font-semibold text-white mb-6 uppercase tracking-wider flex items-center gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),"Continue Playing"]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[b.coverImage?e.jsx("img",{src:b.coverImage,alt:b.title,className:"w-20 h-24 rounded-lg object-cover shadow-lg"}):e.jsx("div",{className:"w-20 h-24 bg-gray-700 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-3xl",children:"ðŸŽ®"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-xl font-bold text-white mb-2",children:b.title}),e.jsx("div",{className:"text-sm text-gray-400 mb-4",children:(k=b.genres)==null?void 0:k.slice(0,2).map(d=>e.jsx("span",{className:"inline-block bg-gray-600 px-2 py-1 rounded mr-2 mb-1",children:typeof d=="string"?d:d.name},typeof d=="string"?d:d.name))}),e.jsxs("button",{onClick:()=>g(b),className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-bold rounded-xl shadow-lg transform hover:scale-105 transition-all",children:[e.jsx("span",{className:"mr-2",children:"â–¶ï¸"}),"Resume Session"]})]})]})]})})]}),e.jsx(L.section,{className:"mb-12",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h3",{className:"text-lg font-gaming font-semibold text-white mb-6 uppercase tracking-wider text-center",children:"Recent Achievements"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:y.map((d,S)=>e.jsxs(L.div,{className:"gaming-card rounded-xl p-6 text-center border border-white/10",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},children:[e.jsx("div",{className:`w-16 h-16 ${d.color} rounded-full flex items-center justify-center mx-auto mb-4`,children:e.jsx("span",{className:"text-2xl",children:d.icon})}),e.jsx("div",{className:"text-sm font-semibold text-white",children:d.title})]},d.id))})]})})]})]})},kt=()=>e.jsx(xt,{});export{kt as Home};
