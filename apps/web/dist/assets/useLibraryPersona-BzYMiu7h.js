import{r as b}from"./index-2zxZw9Mw.js";import{u as g,b as d}from"./useCurrentMood-DCnI8z6_.js";import{u as S}from"./useLibraryStore-BvHGHpT8.js";function R(){const{games:s,intelligence:i}=S(),l=g();return b.useMemo(()=>{try{const r=P(s,i);return d({signals:r,moodEntry:l})}catch(r){return console.warn("Library persona calculation failed, using fallback:",r),d({signals:w(),moodEntry:l})}},[s,i,l])}function P(s,i){const l=s.reduce((e,o)=>{const n=o.hoursPlayed||0;return n>0&&[...o.genres||[],...o.subgenres||[]].forEach(a=>{e[a]=(e[a]||0)+n}),e},{}),r=s.reduce((e,o)=>e+(o.hoursPlayed||0),0),u=s.reduce((e,o)=>e+(o.localSessionCount||0),0);let c=60;i.selectedSessionLength?c={short:30,medium:60,long:120}[i.selectedSessionLength]||60:u>0&&(c=r*60/u);const h=u>0?Math.min(7,Math.max(1,Math.round(u/4))):3,y=s.filter(e=>{const o=e.tags?.some(t=>t.toLowerCase().includes("multiplayer")||t.toLowerCase().includes("co-op")||t.toLowerCase().includes("pvp")||t.toLowerCase().includes("online")),n=e.genres?.some(t=>{const a=typeof t=="string"?t:t?.name||"";return a.toLowerCase().includes("multiplayer")||a.toLowerCase().includes("mmorpg")});return o||n}).length,m=s.length>0?y/s.length:.3,f=s.filter(e=>e.playStatus==="completed").length,L=s.length>0?f/s.length:.5,p=s.reduce((e,o)=>([...o.moods||[],...(o.emotionalTags||[]).map(t=>typeof t=="string"?t:t.name||"")].forEach(t=>{t&&(e[t]=(e[t]||0)+(o.hoursPlayed||0))}),e),{}),M=Object.entries(p).reduce((e,[o,n])=>{const t=Number(n)||0;return e[o]=t>0?Math.min(100,t/(r||1)*100):0,e},{});return{playtimeByGenre:l,averageSessionLengthMinutes:c,sessionsPerWeek:h,difficultyPreference:"Normal",multiplayerRatio:m,lateNightRatio:.2,completionRate:L,moodDistribution:p,moodAffinity:M}}function w(){return{playtimeByGenre:{},averageSessionLengthMinutes:75,sessionsPerWeek:3,difficultyPreference:"Normal",multiplayerRatio:.3,lateNightRatio:.15,completionRate:.4}}export{R as u};
