var S=Object.defineProperty;var w=(o,e,t)=>e in o?S(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var p=(o,e,t)=>(w(o,typeof e!="symbol"?e+"":e,t),t);import{r as b}from"./index-db369dc9.js";import{u as M}from"./useLibraryStore-cd6ac89d.js";function P(o){const e=D(o),t=k(o),n=x(o),r=H(o),s=C(o),i=T(o);return{archetypeId:e,intensity:t,pacing:n,riskProfile:r,socialStyle:s,confidence:i}}function D(o){const{completionRate:e,playtimeByGenre:t,multiplayerRatio:n,difficultyPreference:r}=o;if(e>.7)return"Specialist";const s=t.Strategy||0,i=Object.values(t).reduce((l,a)=>l+a,0);if(i>0&&s/i>.4)return"Strategist";if(n>.6)return"Socializer";const c=(t.Adventure||0)+(t["Open World"]||0);return i>0&&c/i>.4?"Explorer":r==="Brutal"?"Competitor":"Achiever"}function k(o){const{sessionsPerWeek:e,averageSessionLengthMinutes:t}=o;return e>=5||t>=120?"High":e<=2&&t<60?"Low":"Medium"}function x(o){const{averageSessionLengthMinutes:e}=o;return e<45?"Burst":e>120?"Marathon":"Flow"}function H(o){const{difficultyPreference:e}=o;switch(e){case"Relaxed":return"Comfort";case"Normal":return"Balanced";case"Hard":case"Brutal":return"Experimental";default:return"Balanced"}}function C(o){const{multiplayerRatio:e}=o;return e<.2?"Solo":e>.7?"Competitive":"Coop"}function T(o){const e=[o.playtimeByGenre,o.averageSessionLengthMinutes,o.sessionsPerWeek,o.difficultyPreference,o.multiplayerRatio,o.completionRate],n=e.filter(r=>r!=null&&(typeof r!="object"||Object.keys(r).length>0)).length/e.length;return Math.max(.3,Math.min(1,n))}function I(o,e){if(!e)return{traits:o,mood:null};const t={moodId:e.moodId,intensity:e.intensity,timestamp:e.timestamp};return{traits:o,mood:t}}function O(o){const{traits:e,mood:t}=o,n=F(t);return{summary:A(e,t),tone:n}}function F(o){if(!o)return"Reflective";const{moodId:e}=o;return["chill","story","creative"].includes(e)?"Calm":["energetic","social","exploratory"].includes(e)?"Hyped":["competitive","focused"].includes(e)?"Competitive":"Comfort"}function A(o,e){const{archetypeId:t,pacing:n,riskProfile:r}=o,s=R(t),i=N(n),c=z(r),l=e?G(e.moodId):null;return l?`You're a ${s} who prefers ${i} sessions. Currently feeling ${l}, you lean toward ${c} choices.`:`You're a ${s} who thrives in ${i} sessions with a ${c} approach to gaming.`}function R(o){return{Achiever:"goal-oriented achiever",Explorer:"curious explorer",Socializer:"social gamer",Competitor:"competitive player",Strategist:"strategic thinker",Creative:"creative builder",Casual:"relaxed gamer",Specialist:"dedicated specialist"}[o]||"versatile player"}function N(o){return{Burst:"short, intense",Flow:"steady, balanced",Marathon:"long, immersive"}[o]||"moderate"}function z(o){return{Comfort:"comfortable and familiar",Balanced:"balanced and varied",Experimental:"experimental and bold"}[o]||"thoughtful"}function G(o){return{chill:"chill and relaxed",competitive:"competitive and driven",story:"story-focused and immersed",creative:"creative and inspired",social:"social and connected",focused:"focused and determined",energetic:"energetic and excited",exploratory:"exploratory and curious"}[o]||"in a thoughtful mood"}function y(o){if(!o.signals)throw new Error("PersonaSnapshotInput.signals is required");L(o.signals);try{const e=P(o.signals),{mood:t}=I(e,o.moodEntry||void 0),n=O({traits:e,mood:t}),r=e.confidence;return{traits:e,mood:t,narrative:n,confidence:r}}catch(e){throw new Error(`Failed to build persona snapshot: ${e instanceof Error?e.message:"Unknown error"}`)}}function L(o){const e=["playtimeByGenre","averageSessionLengthMinutes","sessionsPerWeek","difficultyPreference","multiplayerRatio","completionRate"];for(const n of e)if(!(n in o))throw new Error(`Missing required field: ${n}`);if(typeof o.playtimeByGenre!="object"||o.playtimeByGenre===null)throw new Error("playtimeByGenre must be a valid object");if(typeof o.averageSessionLengthMinutes!="number"||o.averageSessionLengthMinutes<0)throw new Error("averageSessionLengthMinutes must be a non-negative number");if(typeof o.sessionsPerWeek!="number"||o.sessionsPerWeek<0)throw new Error("sessionsPerWeek must be a non-negative number");const t=["Relaxed","Normal","Hard","Brutal"];if(!t.includes(o.difficultyPreference))throw new Error(`difficultyPreference must be one of: ${t.join(", ")}`);if(typeof o.multiplayerRatio!="number"||o.multiplayerRatio<0||o.multiplayerRatio>1)throw new Error("multiplayerRatio must be a number between 0 and 1");if(typeof o.completionRate!="number"||o.completionRate<0||o.completionRate>1)throw new Error("completionRate must be a number between 0 and 1")}function _(o,e,t=[],n,r,s){const i=new Date;return{moodId:o,intensity:Math.max(1,Math.min(10,e)),timestamp:i,context:n,gameId:r,moodTags:t.slice(0,2),temporalContext:{hourOfDay:i.getHours(),dayOfWeek:i.getDay(),weekOfYear:q(i)},sessionContext:s?{sessionId:s.sessionId,isPreSession:s.isPreSession||!1,isPostSession:s.isPostSession||!1}:void 0}}function j(o,e,t){return{sessionId:o,startTime:new Date,gameId:e,preMood:t||null,postMood:null,sessionDuration:void 0,moodDelta:void 0}}function B(o,e){const t=new Date,n=o.startTime?Math.round((t.getTime()-o.startTime.getTime())/(1e3*60)):void 0,r=o.preMood&&e?e.intensity-o.preMood.intensity:void 0;return{...o,endTime:t,postMood:e||null,sessionDuration:n,moodDelta:r}}function W(o,e,t,n,r=.5){return{recommendationId:o,moodAtTime:e,feedback:t,gameId:n,timestamp:new Date,confidence:Math.max(0,Math.min(1,r))}}function $(o){if(!o||o.length===0)return{bestHours:[],worstHours:[],dayTrends:{}};const e={};o.forEach(a=>{const d=a.temporalContext.hourOfDay;e[d]||(e[d]=[]),e[d].push(a.intensity)});const t={};Object.entries(e).forEach(([a,d])=>{t[parseInt(a)]=d.reduce((m,u)=>m+u,0)/d.length});const n=Object.entries(t).sort(([,a],[,d])=>d-a).map(([a])=>parseInt(a)),r=n.slice(0,3),s=n.slice(-3),i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],c={};o.forEach(a=>{const d=i[a.temporalContext.dayOfWeek];c[d]||(c[d]=[]),c[d].push(a.intensity)});const l={};return Object.entries(c).forEach(([a,d])=>{l[a]=d.reduce((m,u)=>m+u,0)/d.length}),{bestHours:r,worstHours:s,dayTrends:l}}function U(o){if(!o||o.length===0)return[];const e={};return o.forEach(n=>{if(n.moodTags.length>0){const r=`${n.moodId}+${n.moodTags[0]}`;e[r]||(e[r]={count:0,intensities:[]}),e[r].count++,e[r].intensities.push(n.intensity)}}),Object.entries(e).map(([n,r])=>{const[s,i]=n.split("+"),c=r.intensities.reduce((a,d)=>a+d,0)/r.intensities.length,l=r.count/o.length;return{primary:s,secondary:i,frequency:l,averageIntensity:c}}).sort((n,r)=>r.frequency-n.frequency).slice(0,5)}function Y(o){const e=o.filter(a=>a.preMood&&a.postMood&&a.sessionDuration);if(e.length===0)return{averageMoodDelta:0,positiveSessionRatio:0,sessionDurationImpact:0};const t=e.map(a=>a.moodDelta||0),n=t.reduce((a,d)=>a+d,0)/t.length,s=t.filter(a=>a>0).length/e.length,i=e.map(a=>a.sessionDuration||0),c=i.reduce((a,d)=>a+d,0)/i.length,l=Math.abs(n)/Math.max(c,1);return{averageMoodDelta:n,positiveSessionRatio:s,sessionDurationImpact:l}}function q(o){const e=new Date(o.getFullYear(),0,1),t=(o.getTime()-e.getTime())/864e5;return Math.ceil((t+e.getDay()+1)/7)}const Z={enableTemporalPatterns:!0,enableSessionTracking:!0,enableCompoundMoods:!0,enableFeedbackLoop:!0,maxHistorySize:1e3};class J{constructor(e={}){this.moodHistory=[],this.sessionHistory=[],this.feedbackHistory=[],this.config={...Z,...e}}buildEnhancedPersonaSnapshot(e,t){const r={...y(e)};return this.config.enableTemporalPatterns&&(t!=null&&t.moodEvents)&&(r.temporalInsights=$(t.moodEvents)),this.config.enableSessionTracking&&(t!=null&&t.sessionEvents)&&(r.sessionInsights=Y(t.sessionEvents)),this.config.enableCompoundMoods&&(t!=null&&t.moodEvents)&&(r.compoundMoods=U(t.moodEvents)),r}recordMood(e,t,n=[],r,s,i){const c=_(e,t,n,r,s,i);return this.moodHistory.push(c),this.moodHistory.length>this.config.maxHistorySize&&(this.moodHistory=this.moodHistory.slice(-this.config.maxHistorySize)),c}startSession(e,t){const n=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r=j(n,e,t);return this.sessionHistory.push(r),this.sessionHistory.length>this.config.maxHistorySize&&(this.sessionHistory=this.sessionHistory.slice(-this.config.maxHistorySize)),n}endSession(e,t){const n=this.sessionHistory.findIndex(i=>i.sessionId===e);if(n===-1)return null;const r=this.sessionHistory[n],s=B(r,t);return this.sessionHistory[n]=s,s}recordFeedback(e,t,n,r,s=.5){const i=W(e,t,n,r,s);return this.feedbackHistory.push(i),this.feedbackHistory.length>this.config.maxHistorySize&&(this.feedbackHistory=this.feedbackHistory.slice(-this.config.maxHistorySize)),i}getMoodHistory(){return[...this.moodHistory]}getSessionHistory(){return[...this.sessionHistory]}getFeedbackHistory(){return[...this.feedbackHistory]}getConfig(){return{...this.config}}updateConfig(e){this.config={...this.config,...e}}clearHistory(){this.moodHistory=[],this.sessionHistory=[],this.feedbackHistory=[]}}function K(o){return new J(o)}var E;const Q=typeof process<"u"&&((E=process.env)==null?void 0:E.ENABLE_ENHANCED_PERSONA)==="true"||!1;class V{constructor(){if(this.enhancedEngine=null,this.isEnabled=Q,this.isEnabled)try{this.enhancedEngine=K({enableTemporalPatterns:!0,enableSessionTracking:!0,enableCompoundMoods:!0,enableFeedbackLoop:!0,maxHistorySize:1e3}),console.log("ðŸš€ Enhanced Persona Engine enabled")}catch(e){console.warn("âš ï¸ Failed to initialize Enhanced Persona Engine, falling back to legacy:",e),this.isEnabled=!1,this.enhancedEngine=null}}buildSnapshot(e){try{if(this.isEnabled&&this.enhancedEngine){const t={moodEvents:this.enhancedEngine.getMoodHistory(),sessionEvents:this.enhancedEngine.getSessionHistory(),feedbackEvents:this.enhancedEngine.getFeedbackHistory()};return this.enhancedEngine.buildEnhancedPersonaSnapshot(e,t)}else return y(e)}catch(t){return console.warn("âš ï¸ Enhanced snapshot build failed, falling back to legacy:",t),y(e)}}recordMood(e,t,n,r,s){if(this.isEnabled&&this.enhancedEngine)try{this.enhancedEngine.recordMood(e,t,n,r,s)}catch(i){console.warn("âš ï¸ Failed to record enhanced mood:",i)}}startSession(e,t){if(this.isEnabled&&this.enhancedEngine)try{return this.enhancedEngine.startSession(e,t)}catch(n){return console.warn("âš ï¸ Failed to start session tracking:",n),null}return null}endSession(e,t){if(this.isEnabled&&this.enhancedEngine)try{return this.enhancedEngine.endSession(e,t)}catch(n){return console.warn("âš ï¸ Failed to end session tracking:",n),null}return null}recordFeedback(e,t,n,r,s){if(this.isEnabled&&this.enhancedEngine)try{this.enhancedEngine.recordFeedback(e,t,n,r,s)}catch(i){console.warn("âš ï¸ Failed to record feedback:",i)}}getMoodHistory(){if(this.isEnabled&&this.enhancedEngine)try{return this.enhancedEngine.getMoodHistory()}catch(e){return console.warn("âš ï¸ Failed to get mood history:",e),[]}return[]}getSessionHistory(){if(this.isEnabled&&this.enhancedEngine)try{return this.enhancedEngine.getSessionHistory()}catch(e){return console.warn("âš ï¸ Failed to get session history:",e),[]}return[]}getFeedbackHistory(){if(this.isEnabled&&this.enhancedEngine)try{return this.enhancedEngine.getFeedbackHistory()}catch(e){return console.warn("âš ï¸ Failed to get feedback history:",e),[]}return[]}getEngineStatus(){if(this.isEnabled&&this.enhancedEngine){const e=this.enhancedEngine.getConfig();return{enhanced:!0,engine:"enhanced",features:{temporalPatterns:e.enableTemporalPatterns,sessionTracking:e.enableSessionTracking,compoundMoods:e.enableCompoundMoods,feedbackLoop:e.enableFeedbackLoop}}}else return{enhanced:!1,engine:"legacy",features:{temporalPatterns:!1,sessionTracking:!1,compoundMoods:!1,feedbackLoop:!1}}}}new V;class X{constructor(){p(this,"baseUrl");p(this,"isDevelopment");typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")?this.baseUrl="http://localhost:3000/api":this.baseUrl="https://gamepilot-api.onrender.com",this.isDevelopment=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")}async getMoodForecast(e){return console.log("ðŸŽ­ Using fallback mood forecast data (API endpoints not implemented)"),{primaryForecast:{predictedMood:"chill",confidence:.85,reasoning:"Fallback forecast - mood API endpoints not yet implemented"},alternativeForecasts:[{mood:"creative",confidence:.75,reasoning:"Alternative based on genre preferences"},{mood:"focused",confidence:.65,reasoning:"Alternative based on session patterns"}],forecastPeriod:"next_week",generatedAt:new Date().toISOString()}}async getMoodResonance(e){return console.log("ðŸŽ­ Using fallback mood resonance data (API endpoints not implemented)"),{moodAccuracy:{chill:.9,energetic:.7,competitive:.8,social:.6,creative:.95,focused:.75,story:.8,exploratory:.85},confidenceAdjustments:{chill:.9,energetic:.7,competitive:.8,social:.6,creative:.95,focused:.75,story:.8,exploratory:.85},sessionPatterns:{chill:{avgDuration:45,avgEngagement:80},energetic:{avgDuration:60,avgEngagement:90},competitive:{avgDuration:75,avgEngagement:95},social:{avgDuration:90,avgEngagement:85},creative:{avgDuration:120,avgEngagement:75},focused:{avgDuration:90,avgEngagement:88},story:{avgDuration:150,avgEngagement:82},exploratory:{avgDuration:120,avgEngagement:78}},insights:{strongestPredictions:["creative","chill","exploratory"],weakestPredictions:["social","energetic","focused"],optimalSessionLength:{chill:45,energetic:60,competitive:75,social:90,creative:120,focused:90,story:150,exploratory:120},engagementPatterns:{chill:80,energetic:90,competitive:95,social:85,creative:75,focused:88,story:82,exploratory:78}}}}async getMoodRecommendations(e){return console.log("ðŸŽ­ Using fallback mood recommendations data (API endpoints not implemented)"),{recommendations:[{gameId:"game1",gameTitle:"Zen Puzzle Master",score:.95,reasoning:"Perfect match for current chill mood",moodAlignment:.9,genreMatch:.95,confidence:.85}],moodToGenreMapping:{chill:["puzzle","casual","simulation","strategy","adventure"],energetic:["action","shooter","racing","sports","platformer"],competitive:["action","shooter","strategy","fighting","racing"],social:["multiplayer","party","mmorpg","co-op","simulation"],creative:["sandbox","building","puzzle","simulation","adventure"],focused:["strategy","puzzle","rpg","turn-based","card"],story:["rpg","adventure","visual-novel","interactive-movie","simulation"],exploratory:["adventure","open-world","sandbox","survival","simulation"]},trendingMoods:["competitive","social","creative"],generatedAt:new Date().toISOString()}}}const ee=new X;class v{static computeMoodProfile(e){if(!e||e.length===0)return this.getDefaultProfile();const t=this.analyzeGenreDistribution(e),n=this.analyzePlaytime(e),r=this.computeMoodScores(e,t),s=this.computePersonalityTraits(r,n);return{primaryMood:Object.entries(r).reduce((c,l)=>r[c[0]]>r[l[0]]?c:l)[0],moodScores:r,genreDistribution:t,playtimeAnalysis:n,personalityTraits:s,lastComputed:new Date}}static analyzeGenreDistribution(e){const t={};let n=0;e.forEach(s=>{var i;(i=s.genres)==null||i.forEach(c=>{const l=c.name.toLowerCase();t[l]=(t[l]||0)+1,n++})});const r={};return Object.entries(t).forEach(([s,i])=>{r[s]=n>0?i/n:0}),r}static analyzePlaytime(e){const t=e.reduce((l,a)=>l+(a.hoursPlayed||0),0),n=e.filter(l=>(l.hoursPlayed||0)>0),r=n.length>0?t/n.length:0,s={};e.forEach(l=>{var d;const a=l.hoursPlayed||0;a>0&&((d=l.genres)==null||d.forEach(m=>{const u=m.name.toLowerCase();s[u]=(s[u]||0)+a}))});const i=Object.entries(s).sort((l,a)=>a[1]-l[1]).slice(0,3).map(([l])=>l),c=this.identifyGamingPatterns(e,t,r);return{totalHours:t,averageSession:r,favoriteGenres:i,gamingPatterns:c}}static identifyGamingPatterns(e,t,n){const r=[];t>1e3?r.push("hardcore-gamer"):t>500?r.push("regular-gamer"):t>100?r.push("casual-gamer"):r.push("new-gamer"),n>10?r.push("long-sessions"):n<2?r.push("short-sessions"):r.push("moderate-sessions");const s=new Set(e.flatMap(i=>{var c;return((c=i.genres)==null?void 0:c.map(l=>l.name.toLowerCase()))||[]})).size;return s>10?r.push("genre-explorer"):s<5&&r.push("genre-specialist"),r}static computeMoodScores(e,t){const n={competitive:0,social:0,creative:0,exploratory:0,focused:0,storyDriven:0,chill:0,energetic:0};e.forEach(s=>{var l,a,d;const i=Math.min((s.hoursPlayed||0)/50,1),c=1/(((l=s.genres)==null?void 0:l.length)||1);(a=s.genres)==null||a.forEach(m=>{const u=m.name.toLowerCase(),h=this.GENRE_MOOD_MAP[u]||[],g=i*c;h.forEach(f=>{n[f]=(n[f]||0)+g})}),(d=s.tags)==null||d.forEach(m=>{const u=m.toLowerCase(),h=this.TAG_MOOD_MAP[u]||[],g=i*.5;h.forEach(f=>{n[f]=(n[f]||0)+g})})});const r=Math.max(...Object.values(n));return r>0&&Object.keys(n).forEach(s=>{n[s]=n[s]/r}),n}static computePersonalityTraits(e,t){const n={...e};t.gamingPatterns.includes("hardcore-gamer")&&(n.competitive*=1.2,n.focused*=1.1),t.gamingPatterns.includes("genre-explorer")&&(n.exploratory*=1.2,n.creative*=1.1),t.gamingPatterns.includes("social-gamer")&&(n.social*=1.3);const r=Math.max(...Object.values(n));return r>1&&Object.keys(n).forEach(s=>{n[s]/=r}),n}static getDefaultProfile(){return{primaryMood:"chill",moodScores:{competitive:.3,social:.4,creative:.5,exploratory:.6,focused:.4,storyDriven:.5,chill:.8,energetic:.3},genreDistribution:{},playtimeAnalysis:{totalHours:0,averageSession:0,favoriteGenres:[],gamingPatterns:["new-gamer"]},personalityTraits:{competitive:.3,social:.4,creative:.5,exploratory:.6,focused:.4,storyDriven:.5,chill:.8,energetic:.3},lastComputed:new Date}}static getMoodRecommendations(e,t,n=10){return e.filter(i=>(i.hoursPlayed||0)<2).map(i=>{var l,a,d;let c=0;return(l=i.genres)==null||l.forEach(m=>{const u=m.name.toLowerCase();(this.GENRE_MOOD_MAP[u]||[]).includes(t.primaryMood)&&(c+=2)}),(a=i.tags)==null||a.forEach(m=>{const u=m.toLowerCase();(this.TAG_MOOD_MAP[u]||[]).includes(t.primaryMood)&&(c+=1)}),(d=i.genres)==null||d.forEach(m=>{const u=m.name.toLowerCase();(this.GENRE_MOOD_MAP[u]||[]).forEach(g=>{c+=t.personalityTraits[g]||0})}),i.globalRating&&(c+=i.globalRating/10),{game:i,score:c}}).sort((i,c)=>c.score-i.score).slice(0,n).map(i=>i.game)}}p(v,"GENRE_MOOD_MAP",{action:["energetic","competitive","focused"],adventure:["exploratory","storyDriven","chill"],rpg:["storyDriven","focused","exploratory"],strategy:["focused","competitive","creative"],puzzle:["focused","creative","chill"],simulation:["creative","chill","exploratory"],sports:["energetic","competitive","social"],racing:["energetic","competitive","focused"],shooter:["competitive","energetic","focused"],platformer:["energetic","focused","exploratory"],fighting:["competitive","energetic","focused"],mmo:["social","exploratory","competitive"],casual:["chill","creative","social"],indie:["creative","exploratory","chill"],horror:["focused","storyDriven","chill"],stealth:["focused","exploratory","competitive"],survival:["exploratory","focused","creative"],music:["creative","chill","energetic"],party:["social","energetic","chill"],board:["social","focused","competitive"],card:["focused","competitive","creative"]}),p(v,"TAG_MOOD_MAP",{multiplayer:["social","competitive"],"single-player":["storyDriven","focused","exploratory"],"co-op":["social","chill","competitive"],achievements:["competitive","focused"],trading:["creative","social"],"free-to-play":["social","chill"],action:["energetic","competitive"],adventure:["exploratory","storyDriven"],rpg:["storyDriven","focused"],strategy:["focused","competitive"],simulation:["creative","chill"],sports:["energetic","competitive"],racing:["energetic","competitive"],puzzle:["focused","creative"],horror:["focused","storyDriven"],survival:["exploratory","focused"]});const te=v;function ie(){const[o,e]=b.useState(null),{games:t}=M();return b.useEffect(()=>{const n=async()=>{var s;try{if(t&&t.length>0){const l=te.computeMoodProfile(t),a={moodId:l.primaryMood,intensity:Math.round(l.moodScores[l.primaryMood]*10),timestamp:l.lastComputed,confidence:.85,source:"steam-data"};e(a);return}const i="current-user",c=await ee.getMoodForecast(i);if((s=c==null?void 0:c.primaryForecast)!=null&&s.predictedMood){const l={moodId:c.primaryForecast.predictedMood,intensity:Math.round(c.primaryForecast.confidence*10),timestamp:new Date(c.generatedAt||Date.now()),confidence:c.primaryForecast.confidence,source:"api"};e(l)}else e({moodId:"zen",intensity:5,timestamp:new Date,confidence:.5,source:"fallback"})}catch{e({moodId:"zen",intensity:5,timestamp:new Date,confidence:.5,source:"fallback"})}};n();const r=setInterval(n,5*60*1e3);return()=>clearInterval(r)},[t]),o}export{y as b,ie as u};
