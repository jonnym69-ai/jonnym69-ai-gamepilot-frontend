import{r as b}from"./index-db369dc9.js";import{u as G,b as h}from"./useCurrentMood-a662386a.js";import{u as w}from"./useLibraryStore-cd6ac89d.js";function v(){const{games:t}=w(),o=G();return b.useMemo(()=>{try{const r=x(t);return h({signals:r,moodEntry:o})}catch(r){return console.warn("Persona snapshot calculation failed, using fallback:",r),h({signals:R(),moodEntry:o})}},[t,o])}function x(t){const o=t.reduce((e,s)=>{const c=s.hoursPlayed||0;return c>0&&[...s.genres||[],...s.tags||[]].map(l=>typeof l=="string"?l:l.name||l.description||"").filter(Boolean).forEach(l=>{const n=l.toLowerCase();e[n]=(e[n]||0)+c}),e},{}),r=t.reduce((e,s)=>e+(s.hoursPlayed||0),0),a=t.filter(e=>e.lastPlayed&&new Date(e.lastPlayed).getTime()>Date.now()-30*24*60*60*1e3).length,f=a>0?Math.max(30,Math.min(180,r*60/Math.max(1,a*2))):60,p=a>0?Math.min(14,Math.max(1,Math.round(a/4))):3,m=t.filter(e=>{var l;const c=(e.tags||[]).map(n=>n.toLowerCase()).some(n=>n.includes("multiplayer")||n.includes("co-op")||n.includes("pvp")||n.includes("online")),d=(l=e.platforms)==null?void 0:l.some(n=>n.code==="steam");return c||d}).length,y=t.length>0?m/t.length:.3,P=t.filter(e=>e.playStatus==="completed").length,M=t.length>0?P/t.length:.5,S=t.filter(e=>{if(!e.lastPlayed)return!1;const s=new Date(e.lastPlayed).getHours();return s>=22||s<=6}).length,g=t.length>0?S/t.length:.2,u=Object.keys(o);let i="Normal";return u.some(e=>e.includes("souls")||e.includes("hardcore")||e.includes("brutal"))?i="Brutal":u.some(e=>e.includes("hard")||e.includes("difficult"))?i="Hard":u.some(e=>e.includes("casual")||e.includes("puzzle")||e.includes("relaxed"))&&(i="Relaxed"),{playtimeByGenre:o,averageSessionLengthMinutes:f,sessionsPerWeek:p,difficultyPreference:i,multiplayerRatio:y,lateNightRatio:g,completionRate:M}}function R(){return{playtimeByGenre:{},averageSessionLengthMinutes:60,sessionsPerWeek:2,difficultyPreference:"Normal",multiplayerRatio:.4,lateNightRatio:.25,completionRate:.3}}export{v as u};
