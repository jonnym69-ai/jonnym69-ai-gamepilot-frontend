import{r as P}from"./index-db369dc9.js";import{u as g,b as y}from"./useCurrentMood-a662386a.js";import{u as w}from"./useLibraryStore-cd6ac89d.js";function v(){const{games:s,intelligence:l}=w(),a=g();return P.useMemo(()=>{try{const i=C(s,l);return y({signals:i,moodEntry:a})}catch(i){return console.warn("Library persona calculation failed, using fallback:",i),y({signals:G(),moodEntry:a})}},[s,l,a])}function C(s,l){const a=s.reduce((e,t)=>{const r=t.hoursPlayed||0;return r>0&&[...t.genres||[],...t.subgenres||[]].forEach(u=>{e[u]=(e[u]||0)+r}),e},{}),i=s.reduce((e,t)=>e+(t.hoursPlayed||0),0),c=s.reduce((e,t)=>e+(t.localSessionCount||0),0);let p=60;l.selectedSessionLength?p={short:30,medium:60,long:120}[l.selectedSessionLength]||60:c>0&&(p=i*60/c);const m=c>0?Math.min(7,Math.max(1,Math.round(c/4))):3,f=s.filter(e=>{var o,u;const t=(o=e.tags)==null?void 0:o.some(n=>n.toLowerCase().includes("multiplayer")||n.toLowerCase().includes("co-op")||n.toLowerCase().includes("pvp")||n.toLowerCase().includes("online")),r=(u=e.genres)==null?void 0:u.some(n=>{const h=typeof n=="string"?n:(n==null?void 0:n.name)||"";return h.toLowerCase().includes("multiplayer")||h.toLowerCase().includes("mmorpg")});return t||r}).length,L=s.length>0?f/s.length:.3,M=s.filter(e=>e.playStatus==="completed").length,b=s.length>0?M/s.length:.5,d=s.reduce((e,t)=>([...t.moods||[],...(t.emotionalTags||[]).map(o=>typeof o=="string"?o:o.name||"")].forEach(o=>{o&&(e[o]=(e[o]||0)+(t.hoursPlayed||0))}),e),{}),S=Object.entries(d).reduce((e,[t,r])=>{const o=Number(r)||0;return e[t]=o>0?Math.min(100,o/(i||1)*100):0,e},{});return{playtimeByGenre:a,averageSessionLengthMinutes:p,sessionsPerWeek:m,difficultyPreference:"Normal",multiplayerRatio:L,lateNightRatio:.2,completionRate:b,moodDistribution:d,moodAffinity:S}}function G(){return{playtimeByGenre:{},averageSessionLengthMinutes:75,sessionsPerWeek:3,difficultyPreference:"Normal",multiplayerRatio:.3,lateNightRatio:.15,completionRate:.4}}export{v as u};
